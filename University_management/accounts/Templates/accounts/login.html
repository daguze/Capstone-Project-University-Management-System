{% extends 'accounts/base.html' %}
{% block content %}

  
  {% if not user.is_authenticated %}
    <h2>Login</h2>   
    <form method="post">
        {% csrf_token %}
      <div class="mb-3">
        <label for="id_username">Username</label>
        <input id="id_username" type="text" class="form-control" name="username" placeholder="Username" required>
      </div>

      <div class="mb-3">
        <label for="id_password">Password</label>
        <input id="id_password" type="password" class="form-control" name="password" placeholder="********" required>
      </div>

      <button type="submit" class="btn btn-primary" formaction="{% url 'login' %}">Submit</button>
    </form>

  

  {% else %}
    <h3>Logged in as {{ user.username }}</h3>
    </br>
    </br>
    
    

    {% if user.user_type == 'admin' %}
      <h4>All Users guests</h4>
      <table class="table table-striped">
        <thead class = "table-dark">
          <tr>
            <th scope="col">id</th>
            <th scope="col">Full name</th>
            <th scope="col">Username</th>
            <th scope="col">Email</th>
            <th scope="col">registraion date</th>
          </tr>
        </thead>
        <tbody>
          
          {% for u in users %}
            <tr>
              <td>{{ u.id }}</td>
              <td>{{ u.full_name }}</a></td>
              <td>{{ u.username }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.registration_Date }}</td>
            </tr>
          {% endfor %}

        </tbody>
      </table>
      <h4>All Staff</h4>
      <table class="table table-striped">
        <thead class = "table-dark">
          <tr>
            <th scope="col">Full name</th>
            <th scope="col">Email</th>
            <th scope="col">department</th>
          </tr>
        </thead>
        <tbody>
          
          {% for s in staffs %}
            <td>{{ s.user.full_name }}</td>
            <td>{{ s.user.email }}</td>
            <td>{{ s.department }}</td>
          {% endfor %}
        </tbody>
      </table> 
      

      <h4>All Students</h4>
      <table class="table table-striped">
        <thead class = "table-dark">
          <tr>
            <th scope="col">Full name</th>
            <th scope="col">Email</th>
            <th scope="col">registration_Date</th>
            <th scope="col">Department</th>
          </tr>
        </thead>
        <tbody>
            {% for s in students %}
              <td><a href="{% url 'students-list-page' %}">{{ s.user.full_name }}</td>
              <td>{{ s.user.email }}</td>
              <td>{{ s.user.registration_Date }}</td>
              <td>{{ s.department }}</td>
            {% endfor %}
          </tbody>
        </table>

    {% elif user.user_type == 'staff' %}
      <h4>Your staff record</h4>
      {% for s in staffs %}
        {% if s.user.id == user.id %}
          <p>{{ s.user.full_name }} {{ s.user.username }} {{ s.department }}</p>
        {% endif %}
      {% endfor %}

      <h4>Students in your department</h4>
      <table class="table table-striped">
        <thead class = "table-dark">
          <tr>
            <th scope="col">Full name</th>
            <th scope="col">Email</th>
            <th scope="col">registration_Date</th>
            <th scope="col">Department</th>
          </tr>
        </thead>
        <tbody>
          {% for st in students %}
            {% if st.department == user.staff_user.department %}
              <td><a href="{% url 'students-list-page' %}"> {{st.user.full_name }}</a></td>
              <td> {{st.user.email }}</td>
              <td> {{st.user.registration_Date }}</td>
              <td> {{st.department }}</td>
            {% endif %}
          {% endfor %}
        </tbody>
      </table>
    {% elif user.user_type == 'student' %}
      <h4>Your student record</h4>
      <table class="table table-striped">
        <thead class = "table-dark">
          <tr>
            <th scope="col">Full name</th>
            <th scope="col">Email</th>
            <th scope="col">registration_Date</th>
            <th scope="col">Department</th>
          </tr>
        </thead>
        <tbody>
          {% for st in students %}
            {% if st.user.id == user.id %}
              <td>{{ st.user.full_name }}</td>
              <td>{{ st.user.email }}</td>
              <td>{{ st.user.registration_Date}}</td>
              <td>{{ st.department }}
            {% endif %}
          {% endfor %}
        </tbody>
      </table>

      <h2>Grades</h2>
      {% if grades %}
        <table class="table table table-striped">
          <thead>
            <tr>
              <th>Course code</th>
              <th>Course title</th>
              <th>Score</th>
            </tr>
          </thead>
          <tbody>
            {% for g in grades %}
              <tr>
                <td>{{ g.course.code }}</td>
                <td>{{ g.course.title }}</td>
                <td>{{ g.score }}</td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <p>No grades yet.</p>
      {% endif %}
    {% endif %}
  {% endif %}


{% endblock %}